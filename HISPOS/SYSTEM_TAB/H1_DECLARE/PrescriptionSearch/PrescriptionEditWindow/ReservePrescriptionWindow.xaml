<Window
    x:Class="His_Pos.SYSTEM_TAB.H1_DECLARE.PrescriptionSearch.PrescriptionEditWindow.ReservePrescriptionWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:command="http://www.galasoft.ch/mvvmlight"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:generalCustomControl="clr-namespace:His_Pos.GeneralCustomControl"
    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
    xmlns:local="clr-namespace:His_Pos.SYSTEM_TAB.H1_DECLARE.PrescriptionSearch.PrescriptionEditWindow"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:newClass="clr-namespace:His_Pos.NewClass"
    xmlns:service="clr-namespace:His_Pos.Service"
    xmlns:xctk="http://schemas.xceed.com/wpf/xaml/toolkit"
    Title="{Binding Title}"
    Width="{Binding WindowWidth, Mode=TwoWay}"
    Height="{Binding WindowHeight, Mode=TwoWay}"
    FontFamily="Segoe UI Semibold"
    Left="{Binding StartLeft, Mode=TwoWay}"
    Top="{Binding StartTop, Mode=TwoWay}"
    d:DataContext="{d:DesignInstance Type=local:PrescriptionEditViewModel}"
    ResizeMode="NoResize"
    mc:Ignorable="d">
    <Window.Background>
        <ImageBrush ImageSource="/Images/tabViewBackground.jpg" />
    </Window.Background>
    <Window.Resources>
        <service:NullableDateConverter x:Key="NullableDateConverter" />
        <service:NullableIntConverter x:Key="NullableIntConverter" />
        <service:SentinelConverter x:Key="SentinelConverter" />
        <DataTemplate x:Key="Edited" DataType="{x:Type local:ReservePrescriptionWindow}">
            <Label
                Margin="40,0,0,10"
                Content="已修改"
                Foreground="Red"
                Style="{StaticResource BoldLabelContent16}" />
        </DataTemplate>
        <DataTemplate x:Key="NonEdited" DataType="{x:Type local:ReservePrescriptionWindow}">
            <Label
                Margin="40,0,0,10"
                Content="未修改"
                Foreground="DimGray"
                Style="{StaticResource BoldLabelContent16}" />
        </DataTemplate>
    </Window.Resources>
    <Viewbox Stretch="Fill">
        <Grid Width="1340" Height="800">
            <Grid.RowDefinitions>
                <RowDefinition Height="45" />
                <RowDefinition Height="165" />
                <RowDefinition />
                <RowDefinition Height="310" />
            </Grid.RowDefinitions>
            <StackPanel Grid.Row="0" Margin="10,0,10,0" Orientation="Horizontal">
                <Image Width="30" Height="30" Margin="10,0,0,0" Source="/Images/IDcard.png" />
                <Label
                    Width="115"
                    Height="35"
                    Margin="0,10,10,10"
                    Content="{Binding EditedPrescription.Patient.IDNumber, UpdateSourceTrigger=PropertyChanged}"
                    Style="{StaticResource BoldLabelContent18}" />
                <Image
                    Width="30" Height="30" Margin="10,0,0,0" Source="/Images/User_48px.png" />
                <Label
                    Width="120"
                    Height="35"
                    Margin="0,10,10,10"
                    Content="{Binding EditedPrescription.Patient.Name, UpdateSourceTrigger=PropertyChanged}"
                    Style="{StaticResource BoldLabelContent18}" />
                <Image Width="30" Height="30" Margin="10,0,0,0" Source="/Images/birthday.png" />
                <Label
                    Width="100"
                    Height="35"
                    Margin="0,10,10,10"
                    Content="{Binding EditedPrescription.Patient.Birthday, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource NullableDateConverter}}"
                    Style="{StaticResource BoldLabelContent18}" />
                <Image
                    Width="30"
                    Height="30"
                    Margin="10,0,0,0"
                    Source="/Images/Phone.png" />
                <Label
                    Width="130"
                    Height="35"
                    Margin="0,10,20,10"
                    Content="{Binding DisplayPatientCellPhone, UpdateSourceTrigger=PropertyChanged}"
                    Style="{StaticResource BoldLabelContent18}" />
                <Image
                    Width="25"
                    Height="25"
                    Margin="10,0,0,0"
                    Source="/Images/Telephone.png" />
                <Label
                    Width="100"
                    Height="35"
                    Margin="10,10,20,10"
                    Content="{Binding  DisplayPatientTel, UpdateSourceTrigger=PropertyChanged}"
                    Style="{StaticResource BoldLabelContent18}" />
                <Label
                    Width="270"
                    Height="35"
                    Content="{Binding EditedPrescription.OrderContent, UpdateSourceTrigger=PropertyChanged}"
                    Style="{StaticResource BoldLabelContent16}" />
                <StackPanel Margin="10,10,10,0" Orientation="Horizontal">
                    <Label
                        Height="35"
                        Content="列印 : "
                        Foreground="DimGray"
                        Style="{StaticResource BoldLabelContent18}" />
                    <Button
                        Height="35"
                        Margin="10,0,0,0"
                        Background="RoyalBlue"
                        BorderBrush="RoyalBlue"
                        Command="{Binding DataContext.PrintReceipt, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                        Content="收據" />
                    <Button
                        Height="35"
                        Margin="10,0,0,0"
                        Background="RoyalBlue"
                        BorderBrush="RoyalBlue"
                        Command="{Binding DataContext.PrintMedBag, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                        Content="藥袋" />
                </StackPanel>
            </StackPanel>
            <Grid Grid.Row="1">
                <Grid.RowDefinitions>
                    <RowDefinition />
                    <RowDefinition />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <StackPanel
                    Grid.Row="0"
                    Margin="10"
                    Orientation="Horizontal">
                    <Label Content="釋出院所" Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        Width="445"
                        Height="35"
                        HorizontalContentAlignment="Center"
                        VerticalContentAlignment="Center"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.Institution.FullName, UpdateSourceTrigger=PropertyChanged}"
                        FontStretch="ExtraExpanded"
                        Style="{StaticResource BoldLabelContent17}" />
                    <Label
                        Margin="10,0,0,0"
                        Content="就醫科別"
                        Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        Width="170"
                        HorizontalContentAlignment="Center"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.Division.FullName, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource BoldLabelContent17}" />
                    <Label
                        Margin="15,0,0,0"
                        Content="調劑藥師"
                        Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        x:Name="HisPerson"
                        Width="170"
                        Height="35"
                        HorizontalContentAlignment="Center"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.Pharmacist.Name, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource BoldLabelContent17}" />
                    <Label
                        Margin="15,0,0,0"
                        Content="就醫序號"
                        Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        Width="170"
                        Height="35"
                        HorizontalContentAlignment="Center"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.TempMedicalNumber, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource BoldLabelContent17}" />
                </StackPanel>
                <StackPanel
                    Grid.Row="1"
                    Margin="10"
                    Orientation="Horizontal">
                    <Label Content="就醫日期" Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        x:Name="TreatDate"
                        Width="160"
                        Height="34"
                        Margin="10,0,0,0"
                        HorizontalContentAlignment="Center"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.TreatDate, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource NullableDateConverter}}"
                        FontSize="16"
                        Foreground="{StaticResource ForeGround}"
                        InputMethod.IsInputMethodEnabled="False"
                        Style="{StaticResource BoldLabelContent17}" />
                    <Label
                        Margin="19,0,0,0"
                        Content="調劑日期"
                        Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        Width="170"
                        Height="35"
                        HorizontalContentAlignment="Center"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.AdjustDate, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource NullableDateConverter}}"
                        Style="{StaticResource BoldLabelContent17}" />
                    <Label
                        Margin="15,0,0,0"
                        Content="主要診斷"
                        Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        x:Name="MainDisease"
                        Width="170"
                        Height="35"
                        HorizontalContentAlignment="Center"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.MainDisease.FullName, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource BoldLabelContent17}" />
                    <Label
                        Margin="15,0,0,0"
                        Content="次要診斷"
                        Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        x:Name="SecondDiagnosis"
                        Width="170"
                        Height="35"
                        HorizontalContentAlignment="Center"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.SubDisease.FullName, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource BoldLabelContent17}" />
                    <Label
                        Margin="15,0,0,0"
                        Content="領藥次數"
                        Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        Width="66"
                        Height="35"
                        HorizontalContentAlignment="Center"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.ChronicTotal, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource NullableIntConverter}}"
                        InputMethod.IsInputMethodEnabled="False"
                        Style="{StaticResource BoldLabelContent17}" />
                    <Label Content=" 一 " Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        Width="66"
                        Height="35"
                        HorizontalContentAlignment="Center"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.ChronicSeq, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource NullableIntConverter}}"
                        Style="{StaticResource BoldLabelContent17}" />
                </StackPanel>
                <StackPanel
                    Grid.Row="2"
                    Margin="10"
                    Orientation="Horizontal">
                    <Label
                        Height="35"
                        Content="調劑案件"
                        Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        Width="170"
                        Height="35"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.AdjustCase.FullName, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource BoldLabelContent17}" />
                    <Label
                        Margin="19,0,0,0"
                        Content="處方案件"
                        Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        Width="170"
                        Height="34"
                        HorizontalContentAlignment="Center"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.PrescriptionCase.FullName, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource BoldLabelContent17}" />
                    <Label
                        Margin="15,0,0,0"
                        Content="部分負擔"
                        Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        Width="170"
                        Height="35"
                        HorizontalContentAlignment="Center"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.Copayment.FullName, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource BoldLabelContent17}" />
                    <Label
                        Margin="15,0,0,0"
                        Content="給付類別"
                        Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        Width="170"
                        Height="35"
                        HorizontalContentAlignment="Center"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.PaymentCategory.FullName, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource BoldLabelContent17}" />
                    <Label
                        Margin="15,0,0,0"
                        Content="特定治療"
                        Style="{StaticResource BoldLabelContent18}" />
                    <Label
                        Width="170"
                        Height="34"
                        HorizontalContentAlignment="Center"
                        BorderBrush="DimGray"
                        BorderThickness="0,0,0,1"
                        Content="{Binding EditedPrescription.SpecialTreat.FullName, UpdateSourceTrigger=PropertyChanged}"
                        Style="{StaticResource BoldLabelContent17}" />
                </StackPanel>
            </Grid>
            <DataGrid
                x:Name="PrescriptionMedicines"
                Grid.Row="2"
                Margin="10,0,10,10"
                AutoGenerateColumns="False"
                Background="{StaticResource GridBackGround}"
                CanUserAddRows="False"
                CanUserDeleteRows="False"
                CanUserSortColumns="False"
                CellStyle="{StaticResource DataGridCellStyle}"
                ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                EnableRowVirtualization="False"
                FrozenColumnCount="3"
                GridLinesVisibility="Horizontal"
                ItemsSource="{Binding EditedPrescription.Medicines, UpdateSourceTrigger=PropertyChanged}"
                SelectedItem="{Binding EditedPrescription.SelectedMedicine, Mode=TwoWay, Converter={StaticResource SentinelConverter}}">
                <DataGrid.Resources>
                    <Style TargetType="{x:Type ScrollBar}">
                        <Setter Property="SnapsToDevicePixels" Value="True" />
                        <Setter Property="OverridesDefaultStyle" Value="False" />
                        <Setter Property="Width" Value="100" />
                        <Style.Triggers>
                            <Trigger Property="Orientation" Value="Horizontal">
                                <Setter Property="Width" Value="Auto" />
                                <Setter Property="Height" Value="15" />
                                <Setter Property="Template" Value="{StaticResource HorizontalScrollBar}" />
                            </Trigger>
                            <Trigger Property="Orientation" Value="Vertical">
                                <Setter Property="Width" Value="15" />
                                <Setter Property="Height" Value="Auto" />
                                <Setter Property="Template" Value="{StaticResource VerticalScrollBar}" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                    <newClass:BindingProxy x:Key="proxy" Data="{Binding}" />
                </DataGrid.Resources>
                <DataGrid.RowStyle>
                    <Style BasedOn="{StaticResource {x:Type DataGridRow}}" TargetType="{x:Type DataGridRow}">
                        <Setter Property="Background" Value="Transparent" />
                        <Setter Property="BorderBrush" Value="Transparent" />
                        <Setter Property="FontSize" Value="16" />
                        <Setter Property="Height" Value="40" />
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="{StaticResource GridDarkerBackGround}" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>
                <DataGrid.Columns>
                    <DataGridTextColumn
                        MinWidth="20"
                        Binding="{Binding Order, UpdateSourceTrigger=PropertyChanged}"
                        FontSize="16"
                        FontWeight="Bold"
                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn
                        MinWidth="150"
                        Binding="{Binding ID, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                        FontSize="16"
                        FontWeight="Bold"
                        Header="健保代碼"
                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                                <Setter Property="Margin" Value="10,0,0,0" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTemplateColumn
                        MinWidth="400"
                        MaxWidth="400"
                        CanUserResize="False"
                        Header="藥品名稱"
                        IsReadOnly="True">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <StackPanel Margin="10,0,0,0" Orientation="Horizontal">
                                    <generalCustomControl:ProductStatusIcon
                                        ControlLevel="{Binding ControlLevel, UpdateSourceTrigger=PropertyChanged}"
                                        IsCommon="{Binding IsCommon, UpdateSourceTrigger=PropertyChanged}"
                                        IsFrozen="{Binding Frozen, UpdateSourceTrigger=PropertyChanged}"
                                        IsInventoryError="{Binding InventoryError, UpdateSourceTrigger=PropertyChanged}" />
                                    <Label
                                        Height="35"
                                        Margin="-5,0,0,0"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Center"
                                        Content="{Binding FullName, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                                        FontSize="16" />
                                </StackPanel>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                        <DataGridTemplateColumn.CellStyle>
                            <Style TargetType="{x:Type DataGridCell}">
                                <EventSetter Event="MouseDoubleClick" Handler="ShowMedicineDetail" />
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="BorderBrush" Value="Transparent" />
                                <Setter Property="Foreground" Value="#FF424040" />
                            </Style>
                        </DataGridTemplateColumn.CellStyle>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn
                        MinWidth="60"
                        Binding="{Binding Dosage, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                        FontSize="16"
                        FontWeight="Bold"
                        Header="用量"
                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn
                        MinWidth="40"
                        Binding="{Binding UsageName, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                        FontSize="16"
                        FontWeight="Bold"
                        Header="用法"
                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn
                        MinWidth="40"
                        Binding="{Binding Days, Mode=OneWay, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource NullableIntConverter}}"
                        FontSize="16"
                        FontWeight="Bold"
                        Header="天數"
                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn
                        MinWidth="40"
                        Binding="{Binding PositionID, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                        FontSize="16"
                        FontWeight="Bold"
                        Header="途徑"
                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn
                        MinWidth="40"
                        Binding="{Binding Amount, Mode=OneWay, StringFormat=N2, UpdateSourceTrigger=PropertyChanged}"
                        FontSize="16"
                        FontWeight="Bold"
                        Header="總量"
                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn
                        MinWidth="60"
                        Binding="{Binding NHIPrice, UpdateSourceTrigger=PropertyChanged}"
                        FontSize="16"
                        FontWeight="Bold"
                        Header="健保價"
                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTemplateColumn
                        MinWidth="40"
                        Header="自費"
                        IsReadOnly="True">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <CheckBox
                                    x:Name="PaySelf"
                                    HorizontalAlignment="Center"
                                    HorizontalContentAlignment="Center"
                                    IsChecked="{Binding PaySelf, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    IsEnabled="False" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn
                        MinWidth="60"
                        Binding="{Binding Price, Mode=OneWay, StringFormat=N2, UpdateSourceTrigger=PropertyChanged}"
                        FontSize="16"
                        FontWeight="Bold"
                        Header="自費價"
                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn MinWidth="60" Binding="{Binding TotalPrice, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}"
                        FontSize="16" FontWeight="Bold" Header="總價" IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn
                        MinWidth="60"
                        Binding="{Binding AveragePrice, StringFormat=N2, UpdateSourceTrigger=PropertyChanged}"
                        FontSize="16"
                        FontWeight="Bold"
                        Header="進價"
                        IsReadOnly="True">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="HorizontalAlignment" Value="Center" />
                                <Setter Property="VerticalAlignment" Value="Center" />
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
            <Grid Grid.Row="3" Width="1320"  Margin="10,0,10,10" Background="{StaticResource GridBackGround}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="390" />
                    <ColumnDefinition />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition />
                    <RowDefinition />
                    <RowDefinition />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Horizontal">
                    <Image Width="25" Height="25" Margin="10,0,10,0" Source="/Images/Phone.png" />
                    <TextBox
                        Name="PatientCellPhone"
                        Width="130"
                        Height="30"
                        Margin="0,0,20,0"
                        HorizontalContentAlignment="Center"
                        materialDesign:HintAssist.Hint="手機"
                        FontSize="16"
                        Foreground="{StaticResource ForeGround}"
                        Text="{Binding DataContext.DisplayPatientCellPhone, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType={x:Type Window}}}">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="PreviewKeyDown">
                                <i:InvokeCommandAction Command="{Binding DataContext.CustomerDetailEdited, RelativeSource={RelativeSource AncestorType={x:Type Window}}}" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                    </TextBox>
                    <Image Width="20" Height="25" Margin="10,0,10,0" Source="/Images/Telephone.png" />
                    <TextBox  Name="PatientTel" Width="130" Height="30" Margin="5,0,20,0"
                        HorizontalContentAlignment="Center" materialDesign:HintAssist.Hint="家電" FontSize="16"
                        Foreground="{StaticResource ForeGround}"
                        Text="{Binding DataContext.DisplayPatientTel, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType={x:Type Window}}}">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="PreviewKeyDown">
                                <i:InvokeCommandAction Command="{Binding DataContext.CustomerDetailEdited, RelativeSource={RelativeSource AncestorType={x:Type Window}}}" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                    </TextBox>
                </StackPanel>
                <StackPanel
                    Grid.Row="1"
                    Grid.Column="0"
                    Orientation="Horizontal">
                    <Image
                        Width="25"
                        Height="25"
                        Margin="10,0,10,0"
                        Source="/Images/home-address.png" />
                    <TextBox
                        Name="PatientAddress"
                        Width="325"
                        Height="30"
                        Margin="0,0,20,0"
                        HorizontalContentAlignment="Center"
                        materialDesign:HintAssist.Hint="地址"
                        FontSize="16"
                        Foreground="{StaticResource ForeGround}"
                        Text="{Binding DataContext.EditedPrescription.Patient.Address, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType={x:Type Window}}}">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="PreviewKeyDown">
                                <i:InvokeCommandAction Command="{Binding DataContext.CustomerDetailEdited, RelativeSource={RelativeSource AncestorType={x:Type Window}}}" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                    </TextBox>
                </StackPanel>
                <StackPanel
                    Grid.Row="2"
                    Grid.Column="0"
                    Orientation="Horizontal">
                    <Image
                        Width="21"
                        Height="25"
                        Margin="12,0,10,0"
                        Source="/Images/email.png" />
                    <TextBox
                        Name="PatientEmail"
                        Width="325"
                        Height="30"
                        Margin="1,0,20,0"
                        HorizontalContentAlignment="Center"
                        materialDesign:HintAssist.Hint="電子信箱"
                        FontSize="16"
                        Foreground="{StaticResource ForeGround}"
                        Text="{Binding DataContext.EditedPrescription.Patient.Email, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType={x:Type Window}}}">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="PreviewKeyDown">
                                <i:InvokeCommandAction Command="{Binding DataContext.CustomerDetailEdited, RelativeSource={RelativeSource AncestorType={x:Type Window}}}" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                    </TextBox>
                </StackPanel>
                <StackPanel Grid.Row="3"  Grid.Column="0"  Orientation="Horizontal">
                    <Image Width="21"  Height="25" Margin="12,0,10,0" Source="/Images/line.png" />
                    <TextBox
                        Name="PatientLine"
                        Width="325"
                        Height="30"
                        Margin="1,0,20,0"
                        HorizontalContentAlignment="Center"
                        materialDesign:HintAssist.Hint="Line ID"
                        FontSize="16"
                        Foreground="{StaticResource ForeGround}"
                        Text="{Binding DataContext.EditedPrescription.Patient.Line, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType={x:Type Window}}}">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="PreviewKeyDown">
                                <i:InvokeCommandAction Command="{Binding DataContext.CustomerDetailEdited, RelativeSource={RelativeSource AncestorType={x:Type Window}}}" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                    </TextBox>
                </StackPanel>
                <Grid Grid.Row="0" Grid.RowSpan="4" Grid.Column="1" >
                    <Grid.RowDefinitions>
                        <RowDefinition Height="35"/>
                        <RowDefinition Height="30"/>
                        <RowDefinition Height="35"/>
                        <RowDefinition/>
                        <RowDefinition Height="50"/>
                    </Grid.RowDefinitions>

                    <Label Content="聯絡備註" FontSize="16" VerticalAlignment="Center" Foreground="{StaticResource ForeGround}" />

                    <TextBox Grid.Row="1" Margin="10,0" Background="{StaticResource LightForeGround}" BorderThickness="0" FontSize="16" FontWeight="Bold" Foreground="{StaticResource ForeGround}"
                             Text="{Binding DataContext.DisplayPatientContactNote, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType={x:Type Window}}}">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="PreviewKeyDown">
                                <i:InvokeCommandAction Command="{Binding DataContext.CustomerDetailEdited, RelativeSource={RelativeSource AncestorType={x:Type Window}}}" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                    </TextBox>
                    <Label  Content="備註" FontSize="16" Grid.Row="2" VerticalAlignment="Center" Foreground="{StaticResource ForeGround}" />

                    <TextBox Grid.Row="3"  Margin="10,0"  VerticalContentAlignment="Top" AcceptsReturn="True"
                        Background="{StaticResource LightForeGround}" BorderThickness="0" FontSize="16"  FontWeight="Bold" Foreground="{StaticResource ForeGround}"
                        Text="{Binding DataContext.DisplayPatientNote, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                        TextWrapping="Wrap" VerticalScrollBarVisibility="Visible">
                        <i:Interaction.Triggers>
                            <i:EventTrigger EventName="PreviewKeyDown">
                                <i:InvokeCommandAction Command="{Binding DataContext.CustomerDetailEdited, RelativeSource={RelativeSource AncestorType={x:Type Window}}}" />
                            </i:EventTrigger>
                        </i:Interaction.Triggers>
                    </TextBox>

                    <StackPanel Grid.Row="4" Orientation="Horizontal"  Margin="640,10,0,0" >
                        <ContentControl Grid.Row="4" Content="{Binding}">
                            <ContentControl.Style>
                                <Style TargetType="{x:Type ContentControl}">
                                    <Setter Property="ContentTemplate" Value="{StaticResource Edited}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding DataContext.CustomerEdited, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType={x:Type Window}}}" Value="true">
                                            <Setter Property="ContentTemplate" Value="{StaticResource Edited}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding DataContext.CustomerEdited, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType={x:Type Window}}}" Value="false">
                                            <Setter Property="ContentTemplate" Value="{StaticResource NonEdited}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ContentControl.Style>
                        </ContentControl>
                        <Button Width="80" Height="30" Margin="10,0,0,10" Background="DimGray" BorderBrush="DimGray"   Content="取消"
                            Command="{Binding DataContext.CustomerRedoEdited, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                            IsEnabled="{Binding DataContext.CustomerEdited, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType={x:Type Window}}}" />

                        <Button Width="80" Height="30" Margin="10,0,0,10" Background="IndianRed" BorderBrush="IndianRed" Content="存檔"
                            Command="{Binding DataContext.SavePatientData, RelativeSource={RelativeSource AncestorType={x:Type Window}}}"
                            IsEnabled="{Binding DataContext.CustomerEdited, UpdateSourceTrigger=PropertyChanged, RelativeSource={RelativeSource AncestorType={x:Type Window}}}" />
                    </StackPanel>

                 
                </Grid>
            </Grid>
        </Grid>
    </Viewbox>
</Window>